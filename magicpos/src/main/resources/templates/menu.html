<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/user/main_layout}">
<head>
    <link rel="stylesheet" th:href="@{/css/menu.css}">
</head>
<body layout:fragment="content">
    <div class="container">
        <div class="main-panel">
            <!-- ÌëúÏÉÅ Î©îÎâ¥ -->
            <div class="top-menu">
                <button class="icon-button">
                    <img th:src="@{/images/Îí§Î°úÍ∞ÄÍ∏∞.png}" alt="Îí§Î°úÍ∞ÄÍ∏∞">
                </button>

                <div class="menu-tabs">
                    <button th:each="category : ${categories}"
                            th:text="${category.cName}"
                            th:classappend="${category.no} == ${selectedCategory} ? 'active' : ''"
                            th:onclick="'location.href=\'/menu?selectedCategory=' + ${category.no} + '\''">
                    </button>
                </div>
                
                <button class="icon-button">
                    <img th:src="@{/images/Îã§ÏùåÌéòÏù¥ÏßÄ.png}" alt="Îã§ÏùåÌéòÏù¥ÏßÄ">
                </button>
                
                <form action="/menu" method="get" class="search-form">
                    <input type="text" name="keyword" placeholder="ÏÉÅÌíàÎ™Ö Í≤ÄÏÉâ">
                    <button type="submit">
                        <img th:src="@{/images/Í≤ÄÏÉâ.png}">
                    </button>
                </form>
            </div>
            
            <div class="product-list">
                <div class="grid-container">
                    <div th:each="product : ${products}" class="product-card">
                        <div class="product-inner">
                            <div class="product-front">
                                <img th:src="@{${product.imgPath}}" class="product-image">
                                <div class="product-info">
                                    <div th:text="${product.pName}">ÏÉÅÌíàÎ™Ö</div>
                                    <div th:text="${#numbers.formatInteger(product.pPrice, 3, 'COMMA') + 'Ïõê'}">Í∞ÄÍ≤©</div>
                                </div>
                            </div>
                            <div class="product-back">
                                <div class="back-frame">
                                    <p th:text="${product.description}">ÏÉÅÌíà ÏÑ§Î™Ö</p>
                                </div>
                                <form method="post" action="/carts/add">
                                    <input type="hidden" name="pNo" th:value="${product.No}">
                                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                                    <button type="submit" class="add-cart-btn">Îã¥Í∏∞</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="side-panel">
            <div class="seat-info">
                <div>Ï¢åÏÑùÎ≤àÌò∏ <strong th:text="${usageInfo.seat_id}">50</strong></div>
                <button id="openModalBtn">Ï£ºÎ¨∏ÎÇ¥Ïó≠Î≥¥Í∏∞</button>
            </div>

            <!-- Ï£ºÎ¨∏ Ìèº ÏãúÏûë -->
            <div class="cart-section">
                <div class="cart-items">
                    <div th:each="cart, cartStat : ${cartList != null ? cartList : {}}" class="cart-item">
                        <div class="cart-item-left">
                            <div th:text="${cart.p_name} ?: 'Ïù¥Î¶ÑÏóÜÏùå'">ÏÉÅÌíàÏù¥Î¶Ñ</div>
                            <div class="quantity-control">
                                <!-- ÏàòÎüâ Í∞êÏÜå/Ï¶ùÍ∞Ä/ÏÇ≠Ï†ú formÏùÄ Ï£ºÎ¨∏ form Î∞ñÏóê ÏúÑÏπò -->
                                <form action="/carts/decrease" method="post">
                                    <input type="hidden" name="pNo" th:value="${cart.p_no}" />
                                    <button type="submit" class="cartcontrolBtn">
                                        <img th:src="@{/images/ÎßàÏù¥ÎÑàÏä§ ÌïòÏñÄÏÉâ.png}" alt="Í∞êÏÜå">
                                    </button>
                                </form>
                                <span th:text="${cart.quantity}">1</span>
                                <form action="/carts/increase" method="post">
                                    <input type="hidden" name="pNo" th:value="${cart.p_no}" />
                                    <button type="submit" class="cartcontrolBtn">
                                        <img th:src="@{/images/ÌîåÎü¨Ïä§ ÎÖ∏ÎûÄÏÉâ.png}" alt="Ï¶ùÍ∞Ä">
                                    </button>
                                </form>
                            </div>
                        </div>
                        <div class="cart-item-right">
                            <div th:text="${(cart.p_price != null and cart.quantity != null) ? #numbers.formatInteger(cart.p_price * cart.quantity, 3, 'COMMA') + 'Ïõê' : '0Ïõê'}">Í∞ÄÍ≤©</div>
                            <form action="/carts/delete" method="post">
                                <input type="hidden" name="cNo" th:value="${cart['no']}" />
                                <button class="deleteBtn">‚úï</button>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="total-price">
                    Ï¥ù Ï£ºÎ¨∏Í∏àÏï° <span th:text="${totalPrice}" style="font-weight: bold;">16,000Ïõê</span>
                </div>
            </div>

            <!-- Ï£ºÎ¨∏ ÌèºÏùÄ cart-section ÏïÑÎûòÏóê ÏúÑÏπò, cartList Ï†ïÎ≥¥Î•º hidden inputÏúºÎ°ú Ï†ÑÎã¨ -->
            <form id="orderForm" action="/users/orders/create" method="post">
                <input type="hidden" name="seatId" th:value="${usageInfo.seat_id}" />
                <div th:each="cart, cartStat : ${cartList != null ? cartList : {}}">
                    <input type="hidden" name="pNoList" th:value="${cart.p_no}" />
                    <input type="hidden" name="quantityList" th:value="${cart.quantity}" />
                    <input type="hidden" name="pNameList" th:value="${cart.p_name}" />
                </div>
                <input type="hidden" name="totalPrice" th:value="${totalPrice}" />
                <div class="payment-methods">
                    <label><input type="radio" name="payment" value="ÌòÑÍ∏à" required>ÌòÑÍ∏à</label>
                    <label><input type="radio" name="payment" value="Ïπ¥Îìú">Ïπ¥Îìú</label>
                    <label><input type="radio" name="payment" value="Ïπ¥Ïπ¥Ïò§ÌéòÏù¥">üí¨<br>QR Í≤∞Ï†ú</label>
                </div>

                <div class="cash-options">
                    <div class="cash-quick">
                        <label><input type="radio" name="cash" value="50000" class="cash-option">5ÎßåÏõê</label>
                        <label><input type="radio" name="cash" value="10000" class="cash-option">1ÎßåÏõê</label>
                        <label><input type="radio" name="cash" value="5000" class="cash-option">5Ï≤úÏõê</label>
                        <label><input type="radio" name="cash" value="1000" class="cash-option">1Ï≤úÏõê</label>
                    </div>
                    <div class="cash-custom">
                        <label><input type="radio" name="cash" value="auto" class="cash-option">Í∏àÏï°Ïóê ÎßûÍ≤å</label>
                        <label><input type="radio" name="cash" value="manual" class="cash-option">ÏßÅÏ†ë ÏûÖÎ†•</label>
                        <input type="text" name="cashManual" />
                    </div>
                </div>
                <input type="text" class="request-input" name="message" maxlength="50" placeholder="ÏöîÏ≤≠ÏÇ¨Ìï≠ÏùÄ 50Ïûê ÍπåÏßÄ ÏûÖÎ†•Ìï† Ïàò ÏûàÏäµÎãàÎã§.">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                <button class="order-button" type="submit">Ï£ºÎ¨∏ÌïòÍ∏∞</button>
            </form>
            <!-- Ï£ºÎ¨∏ Ìèº ÎÅù -->
        </div>
    </div>
    <script th:src="@{/js/userscript.js}"></script>
    <script th:inline="javascript">
    window.orderSuccess = [[${orderSuccess}]];
    </script>
    <script th:if="${error}" th:inline="javascript">
        alert([[${error}]]);
    </script>
</body>
</html>
